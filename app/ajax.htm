<html>
   <head>
      <meta content = "text/html; charset = ISO-8859-1" http-equiv = "content-type">
		<style>
			td,th,table{border:1px solid black;}	
			td{padding:5px 5px 5px 5px;}
		</style>
		<script type = "application/javascript">
		
		// JQUERY, NOT EVEN ONCE!
		
		var brands = [];
		var symptom = "";
		var substances = [];
		var forms = [];
		
		function GenerateChallenge()
		{			
			// haetaan oire ja siihen k‰ytett‰v‰n l‰‰kkeen brandi
			// paikallisesta json-tiedostosta
			loadJSON();
			alert("Brands length: " + brands.length)
			// haetaan brandin perusteella vaikuttava aine
			for (var i = 0;i<brands.length;i++)
			{
				sqlLoadSubstance(brands[i]);
			}
			
			// haetaan brandin perusteella muoto				
			for (var i = 0;i<brands.length;i++)
			{
				sqlLoadForm(brands[i]);
			}
		}
		
        function loadJSON()
		{
            var data_file = "json/data.json";
			
			var bind = function(fn, context) {
				return function() {
					fn.apply(context, arguments);
				};
			};
			
            var http_request = new XMLHttpRequest();
            try
			{
               // Opera 8.0+, Firefox, Chrome, Safari
               http_request = new XMLHttpRequest();
            }
			catch (e)
			{
               // Internet Explorer Browsers
				try
				{
					http_request = new ActiveXObject("Msxml2.XMLHTTP");
				}
				catch (e) 
				{
					try
					{
						http_request = new ActiveXObject("Microsoft.XMLHTTP");
					}
					catch (e)
					{
						// Something went wrong
						alert("Unable to load data from JSON!");
						return false;
					}
				}
            }
			
            http_request.onreadystatechange = bind(function(){
				
               if (http_request.readyState == 4 && http_request.status == 200)
			   {
					alert("Readystate4 status200");
					// Javascript function JSON.parse to parse JSON data
					var jsonObj = JSON.parse(http_request.responseText);
					alert("parsettu json");
					var drugs = jsonObj.drugs;
					alert("otettu parsetusta datasta l‰‰ketaulukko talteen");
					// Math.random() on luku nollasta yhteen desimaalina
					var rand = Math.random() * drugs.length;
					var drugindex = parseInt(rand);
					alert("ennen splitti‰");
					var split = drugs[drugindex].brand.split(",");
					this.brands = split;
					
					/*alert("ennen looppia");
					for(var a = 0;a<split.length;a++)
					{
						this.brands.push(split[a]);
						document.getElementById("brands").innerHTML += split[a];
					}		*/			
					
					alert("Loopin j‰lkeen");
					this.symptom = drugs[index].symptom;					
					document.getElementById("symptom").innerHTML = drugs[index].symptom;
                }
			}, this);
			
            http_request.open("GET", data_file, false);
            http_request.send();			
        }
		
		function sqlLoadSubstance(str) 
		{
			var bind = function(fn, context) {
				return function() {
					fn.apply(context, arguments);
				};
			};
			var http_request = new XMLHttpRequest();
            try
			{
               // Opera 8.0+, Firefox, Chrome, Safari
               http_request = new XMLHttpRequest();
            }
			catch (e)
			{
               // Internet Explorer Browsers
				try
				{
					http_request = new ActiveXObject("Msxml2.XMLHTTP");
				}
				catch (e) 
				{
					try
					{
						http_request = new ActiveXObject("Microsoft.XMLHTTP");
					}
					catch (e)
					{
						// Something went wrong
						alert("Unable to load data from database!");
						return false;
					}
				}
            }
			http_request.onreadystatechange = bind(function() {		
				if (http_request.readyState == 4 && http_request.status == 200) 
				{
					var jsondata = JSON.parse(http_request.responseText);
					this.substances.push(jsondata);					
					document.getElementById("substances").innerHTML += jsondata;
				}
			},this);
			http_request.open("GET","php/getsubstance.php?brand="+encodeURIComponent(str),false);
			http_request.send();			
		}
		
		function sqlLoadForm(str) 
		{
			var bind = function(fn, context) {
				return function() {
					fn.apply(context, arguments);
				};
			};
			var http_request = new XMLHttpRequest();
            try
			{
               // Opera 8.0+, Firefox, Chrome, Safari
               http_request = new XMLHttpRequest();
            }
			catch (e)
			{
               // Internet Explorer Browsers
				try
				{
					http_request = new ActiveXObject("Msxml2.XMLHTTP");
				}
				catch (e) 
				{
					try
					{
						http_request = new ActiveXObject("Microsoft.XMLHTTP");
					}
					catch (e)
					{
						// Something went wrong
						alert("Unable to load data from database!");
						return false;
					}
				}
            }
			http_request.onreadystatechange = bind(function() {
				if (http_request.readyState == 4 && http_request.status == 200) 
				{					
					var jsondata = JSON.parse(http_request.responseText);
					this.forms.push(jsondata);
					document.getElementById("forms").innerHTML += jsondata;
				}
			},this);
			http_request.open("GET","php/getform.php?brand="+encodeURIComponent(str),false);
			http_request.send();
		}
		
		</script>
	
    <title>tutorialspoint.com JSON</title>
	</head>
	
   <body>		
      <table class = "src">
         <tr><th>Brand</th><th>Form</th><th>Substance</th><th>symptom</th></tr>
         <tr><td><div id = "brands">----</div></td>
		 <td><div id = "forms">----</div></td>
		 <td><div id = "substances">----</div></td>
         <td><div id = "symptom">----</div></td></tr>
      </table>

      <div class = "central">
         <button type = "button" onclick = "GenerateChallenge()">Update Details </button>
      </div>
		
   </body>
		
</html>