<html>
   <head>
      <meta content = "text/html; charset = ISO-8859-1" http-equiv = "content-type">
		<style>
			td,th,table{border:1px solid black;}	
			td{padding:5px 5px 5px 5px;}
		</style>
		<script type = "application/javascript">
		
		// JQUERY, NOT EVEN ONCE!
		
		var brands = [];
		var symptom = "";
		var substances = [];
		var forms = [];
		var disease = "";
		
		function GenerateChallenge()
		{			
			brands = [];
			substances = [];
			drugforms = [];
			
			// haetaan oire ja siihen k‰ytett‰v‰n l‰‰kkeen brandi
			// paikallisesta json-tiedostosta
			document.getElementById("brands").innerHTML = "";
			document.getElementById("forms").innerHTML = "";
			document.getElementById("substances").innerHTML = "";
			document.getElementById("symptom").innerHTML = "";
			document.getElementById("diseases").innerHTML = "";
			loadJSON();
			// haetaan brandin perusteella vaikuttava aine
			for (var i = 0;i<brands.length;i++)
			{
				sqlLoadSubstance(brands[i]);
			}			
			// haetaan brandin perusteella muoto				
			for (var i = 0;i<brands.length;i++)
			{
				sqlLoadForm(brands[i]);
			}			
			
			for (var i = 0; i<brands.length;i++)
			{
				document.getElementById("brands").innerHTML += brands[i]  + " - ";
			}
			for (var i = 0; i<drugforms.length;i++)
			{
				document.getElementById("forms").innerHTML += drugforms[i] + " - ";
			}
			for (var i = 0; i<substances.length;i++)
			{
				document.getElementById("substances").innerHTML += substances[i] + " - ";
			}
			
			document.getElementById("disease").innerHTML = disease;
			document.getElementById("symptom").innerHTML = symptom;			
		}
		
		
		// hakee json-tiedostosta satunnaisen tietueen, joka sis‰lt‰‰ oireet tautiin ja siihen sopivien l‰‰kkeiden brandit
		// taudin oireet asetetaan symptoms muuttujaan
		// brandit pushataan brands taulukkoon
        function loadJSON()
		{
            var data_file = "json/data.json";
			
			var bind = function(fn, context) {
				return function() {
					fn.apply(context, arguments);
				};
			};
			
            var http_request = new XMLHttpRequest();
            try
			{
               // Opera 8.0+, Firefox, Chrome, Safari
               http_request = new XMLHttpRequest();
            }
			catch (e)
			{
               // Internet Explorer Browsers
				try
				{
					http_request = new ActiveXObject("Msxml2.XMLHTTP");
				}
				catch (e) 
				{
					try
					{
						http_request = new ActiveXObject("Microsoft.XMLHTTP");
					}
					catch (e)
					{
						// Something went wrong
						alert("Unable to load data from JSON!");
						return false;
					}
				}
            }
			
            http_request.onreadystatechange = bind(function(){
				
               if (http_request.readyState == 4 && http_request.status == 200)
			   {
					// Javascript function JSON.parse to parse JSON data
					var jsonObj = JSON.parse(http_request.responseText);
					var drugs = jsonObj.drugs;
					// Math.random() on luku nollasta yhteen desimaalina
					var rand = Math.random() * drugs.length;
					var index = parseInt(rand);
					var split = drugs[index].brand.split(",");
					this.brands = split;		
					this.disease = drugs[index].disease;
					this.symptom = drugs[index].symptom;					
                }
			}, this);
			
            http_request.open("GET", data_file, false);
            http_request.send();			
        }
		
		
		// Ottaa vastaan brandin nimen stringina
		// Pushaa substances taulukkoon annettua brandia vastaavan l‰‰keaineen
		function sqlLoadSubstance(str) 
		{
			var bind = function(fn, context) {
				return function() {
					fn.apply(context, arguments);
				};
			};
			var http_request = new XMLHttpRequest();
            try
			{
               // Opera 8.0+, Firefox, Chrome, Safari
               http_request = new XMLHttpRequest();
            }
			catch (e)
			{
               // Internet Explorer Browsers
				try
				{
					http_request = new ActiveXObject("Msxml2.XMLHTTP");
				}
				catch (e) 
				{
					try
					{
						http_request = new ActiveXObject("Microsoft.XMLHTTP");
					}
					catch (e)
					{
						// Something went wrong
						alert("Unable to load data from database!");
						return false;
					}
				}
            }
			http_request.onreadystatechange = bind(function() {		
				if (http_request.readyState == 4 && http_request.status == 200) 
				{
					var jsondata = JSON.parse(http_request.responseText);
					this.substances.push(jsondata);					
				}
			},this);
			http_request.open("GET","php/getsubstance.php?brand="+encodeURIComponent(str),false);
			http_request.send();			
		}
		
		
		// Ottaa vastaan brandin nimen stringina
		// Pushaa drugforms taulukkoon annetulle brandille kuuluvan l‰‰kkeen muodon
		function sqlLoadForm(str) 
		{
			var bind = function(fn, context) {
				return function() {
					fn.apply(context, arguments);
				};
			};
			var http_request = new XMLHttpRequest();
            try
			{
               // Opera 8.0+, Firefox, Chrome, Safari
               http_request = new XMLHttpRequest();
            }
			catch (e)
			{
               // Internet Explorer Browsers
				try
				{
					http_request = new ActiveXObject("Msxml2.XMLHTTP");
				}
				catch (e) 
				{
					try
					{
						http_request = new ActiveXObject("Microsoft.XMLHTTP");
					}
					catch (e)
					{
						// Something went wrong
						alert("Unable to load data from database!");
						return false;
					}
				}
            }
			http_request.onreadystatechange = bind(function() {
				if (http_request.readyState == 4 && http_request.status == 200) 
				{					
					var jsondata = JSON.parse(http_request.responseText);
					this.drugforms.push(jsondata);
				}
			},this);
			http_request.open("GET","php/getform.php?brand="+encodeURIComponent(str),false);
			http_request.send();
		}
		
		</script>
	
    <title>tutorialspoint.com JSON</title>
	</head>
	
   <body>		
      <table class = "src">
         <tr><th>Brand</th><th>Form</th><th>Substance</th><th>symptom</th><th>disease</th></tr>
         <tr><td><div id = "brands"></div></td>
		 <td><div id = "forms"></div></td>
		 <td><div id = "substances"></div></td>
         <td><div id = "symptom"></div></td>
		 <td><div id = "disease"></div></td></tr>
      </table>

      <div class = "central">
         <button type = "button" onclick = "GenerateChallenge()">Update Details </button>
      </div>
		
   </body>
		
</html>